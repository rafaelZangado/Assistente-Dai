<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Assistente de ObjeÃ§Ãµes - Call Center</title>
  <style>
    :root{font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
    body{margin:0;padding:20px;background:#f5f7fb;color:#111}
    .app{max-width:980px;margin:0 auto;background:#fff;padding:18px;border-radius:10px;box-shadow:0 8px 30px rgba(10,20,50,.06)}
    h1{margin:0 0 8px;font-size:20px}
    .controls{display:flex;gap:8px;margin:12px 0}
    button{padding:8px 12px;border-radius:8px;border:1px solid #ddd;background:#fff;cursor:pointer}
    button.primary{background:#0b74de;color:#fff;border-color:transparent}
    .status{font-size:13px;color:#666}
    .panels{display:grid;grid-template-columns:1fr 360px;gap:12px;margin-top:14px}
    textarea{width:100%;height:140px;padding:10px;border-radius:8px;border:1px solid #e3e6ee}
    .transcript{height:220px;overflow:auto;padding:10px;border-radius:8px;border:1px solid #e3e6ee;background:#fbfdff}
    .suggestions{display:flex;flex-direction:column;gap:8px}
    .chip{padding:8px;border-radius:8px;border:1px dashed #cfd8e8;background:#fcfeff}
    .small{font-size:13px;color:#555}
    .tag{display:inline-block;padding:6px 8px;border-radius:999px;background:#eef6ff;color:#0359a6;border:1px solid #d6eafc;margin-right:6px;font-size:12px}
    footer{margin-top:18px;font-size:13px;color:#666}
  </style>
</head>
<body>
  <div class="app">
    <h1>Assistente Dai</h1>
    <div class="controls">
      <button id="btnStart" class="primary">Iniciar gravaÃ§Ã£o</button>
      <button id="btnStop">Parar</button>
      <button id="btnClear">Limpar</button>
      <button id="btnAsk">Pedir sugestÃ£o da Assistente (servidor)</button>
      <div style="flex:1"></div>
      <div class="status" id="status">Status: parado</div>
    </div>

    <div class="panels">
      <div>
        <label class="small">TranscriÃ§Ã£o (ao vivo)</label>
        <div id="transcript" class="transcript"></div>

        <label class="small" style="margin-top:10px;display:block">Editor / AnotaÃ§Ãµes</label>
        <textarea id="editor" placeholder="AnotaÃ§Ãµes sobre a ligaÃ§Ã£o..."></textarea>
      </div>

      <div>
        <label class="small">ObjeÃ§Ãµes detectadas</label>
        <div id="detected" style="min-height:120px;padding:10px;border-radius:8px;border:1px solid #eaeef6;background:#fff"></div>

        <div style="height:12px"></div>
        <label class="small">SugestÃµes rÃ¡pidas</label>
        <div class="suggestions" id="suggestions"></div>

        <div style="height:12px"></div>
        <label class="small">SugestÃµes</label>
       <div id="tags" style="margin-top:16px; font-family: Arial, sans-serif;">


      </div>

    </div>
  </div>
        <h3>ğŸ¤ ObjeÃ§Ãµes & Respostas</h3>

  <div class="objection">
    <strong>1. â€œJÃ¡ tenho muitos cartÃµes de crÃ©ditoâ€</strong>
    <ul>
      <li>â€œQue bom, isso mostra que vocÃª jÃ¡ tem crÃ©dito aprovado e os bancos confiam em vocÃª. 
      A diferenÃ§a do nosso cartÃ£o Ã© que ele <b>tem anuidade zero</b> e <b>dÃ¡ cashback</b>. 
      Pode substituir os outros e gerar economia. Quer que eu explique rapidinho?â€</li>
      <li>â€œEntendo, mas justamente por jÃ¡ ter cartÃµes vocÃª sabe o quanto Ã© importante ter um que realmente <b>traga benefÃ­cios</b>. 
      O nosso gera <b>pontos em dobro</b> que vocÃª pode usar em viagens ou compras.â€</li>
    </ul>
  </div>

  <div class="objection">
    <strong>2. â€œNÃ£o quero cartÃ£o de crÃ©ditoâ€</strong>
    <ul>
      <li>â€œTudo bem, sÃ³ para vocÃª saber: o nosso cartÃ£o tambÃ©m funciona como <b>cartÃ£o de dÃ©bito</b> e nÃ£o tem custo de manutenÃ§Ã£o. 
      Ou seja, vocÃª sÃ³ usa se realmente quiser.â€</li>
      <li>â€œMuitas pessoas me dizem isso no comeÃ§o, mas quando conhecem as vantagens como 
      <b>zero anuidade e cashback em todas as compras</b>, acabam achando Ãºtil. Posso te contar em 1 minuto?â€</li>
    </ul>
  </div>

  <div class="objection">
    <strong>3. â€œNÃ£o tenho interesse no momentoâ€</strong>
    <ul>
      <li>â€œPerfeito, eu entendo. Posso apenas te mostrar os benefÃ­cios agora, 
      e quando for o momento certo, vocÃª jÃ¡ vai estar informado e preparado.â€</li>
      <li>â€œClaro, sem problemas. SÃ³ para vocÃª ter em mente: 
      o cartÃ£o dÃ¡ <b>limite extra emergencial</b>, que pode ser Ãºtil em situaÃ§Ãµes inesperadas. 
      Posso te explicar em menos de 1 minuto?â€</li>
    </ul>
  </div>

  <div class="objection">
    <strong>4. â€œNÃ£o obrigadoâ€</strong>
    <ul>
      <li>â€œTudo bem, mas antes de encerrar, posso sÃ³ te contar um detalhe que costuma 
      interessar bastante aos clientes? O cartÃ£o oferece <b>cashback em todas as compras</b>.â€</li>
      <li>â€œSem problemas. SÃ³ para constar: ele nÃ£o tem nenhuma taxa escondida e pode ser 
      <b>cancelado a qualquer momento</b> sem custo.â€</li>
    </ul>
  </div>

  <div class="objection">
    <strong>5. â€œHoje nÃ£o tenho interesse, quem sabe em outro momentoâ€</strong>
    <ul>
      <li>â€œEntendo perfeitamente. Que tal eu te mostrar em 1 minutinho agora, 
      assim quando chegar o momento certo, vocÃª jÃ¡ vai estar preparado para decidir?â€</li>
      <li>â€œClaro, sem problemas. Mas sÃ³ para vocÃª saber, temos uma promoÃ§Ã£o ativa hoje que pode 
      <b>nÃ£o estar disponÃ­vel depois</b>. Posso te explicar rapidinho?â€</li>
    </ul>
  </div>
</div>

<script>
  // Exemplo simples: clique em uma objeÃ§Ã£o para destacar
  document.querySelectorAll('.objection').forEach(item => {
    item.addEventListener('click', () => {
      document.querySelectorAll('.objection').forEach(el => el.style.background = "none");
      item.style.background = "#f0f0f0";
    });
  });
</script>
<script>
// ======= ConfiguraÃ§Ãµes/Mapeamento de objeÃ§Ãµes =======
const objectionsMap = [
  {pattern:/\b(muito[s]? cartÃµes?|muitos cartÃµes)\b/i, label:'JÃ¡ tenho muitos cartÃµes', answers:[
    'Entendo â€” muitas pessoas pensam assim. Posso te mostrar em 30s um benefÃ­cio que pode substituir um custo que vocÃª jÃ¡ tem?',
    'Perfeito, entÃ£o talvez nÃ£o precise de mais um cartÃ£o â€” mas esse pode reduzir as taxas que vocÃª jÃ¡ paga. Quer ouvir em 20s?'
  ]},
  {pattern:/\b(nÃ£o quero|nao quero|nao quero cartÃ£o|nÃ£o quero cartÃ£o)\b/i, label:'NÃ£o quero', answers:[
    'Compreendo. Se pudesse resolver X probleâ ma sem aumentar seus custos, vocÃª consideraria?',
    'Tudo bem â€” sÃ³ 30 segundos: a oferta nÃ£o tem anuidade no primeiro ano e pode te dar descontos, quer que eu explique?'
  ]},
  {pattern:/\b(nÃ£o tenho interesse|sem interesse|nao tenho interesse)\b/i, label:'Sem interesse', answers:[
    'Entendo. O que mais importa pra vocÃª hoje em relaÃ§Ã£o aos seus cartÃµes? Menos anuidade, cashback ou limite maior?',
    'Ok â€” posso te mostrar uma vantagem em 20 segundos que muitas pessoas nem imaginam existir.'
  ]},
  {pattern:/\b(nÃ£o obrigado|nao obrigado)\b/i, label:'NÃ£o obrigado', answers:[
    'Obrigado pelo retorno â€” sÃ³ pra eu melhorar: qual o motivo principal? (anuidade, jÃ¡ tem, prefere dÃ©bito?)',
    'Entendi. Posso te enviar as informaÃ§Ãµes por SMS/WhatsApp para vocÃª olhar no seu tempo?' 
  ]}
];

// ======= UI =======
const btnStart = document.getElementById('btnStart');
const btnStop = document.getElementById('btnStop');
const btnClear = document.getElementById('btnClear');
const btnAsk = document.getElementById('btnAsk');
const statusEl = document.getElementById('status');
const transcriptEl = document.getElementById('transcript');
const editorEl = document.getElementById('editor');
const detectedEl = document.getElementById('detected');
const suggestionsEl = document.getElementById('suggestions');
const tagsEl = document.getElementById('tags');

let recognition, recognizing = false, fullTranscript = '';

function setStatus(s){ statusEl.textContent = 'Status: ' + s; }

// ======= Uso do Web Speech API (Chrome/Edge) =======
if('webkitSpeechRecognition' in window || 'SpeechRecognition' in window){
  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
  recognition = new SpeechRecognition();
  recognition.lang = 'pt-BR';
  recognition.interimResults = true;
  recognition.continuous = true;

  recognition.onstart = () => { recognizing = true; setStatus('ouvindo...'); };
  recognition.onerror = (e) => { console.error(e); setStatus('erro: ' + (e.error||'unknown')); };
  recognition.onend = () => { recognizing = false; setStatus('parado'); };

  recognition.onresult = (event) => {
    let interim = '';
    for(let i=event.resultIndex;i<event.results.length;i++){
      const r = event.results[i];
      if(r.isFinal){ fullTranscript += r[0].transcript + '\n'; }
      else { interim += r[0].transcript; }
    }
    transcriptEl.innerText = fullTranscript + '\n' + interim;
    detectObjections(transcriptEl.innerText);
  };
} else {
  setStatus('SpeechRecognition nÃ£o suportado neste navegador');
}

btnStart.addEventListener('click',()=>{
  if(!recognition) return alert('SpeechRecognition nÃ£o suportado');
  try{ recognition.start(); setStatus('iniciando...'); }catch(e){ console.log(e); }
});
btnStop.addEventListener('click',()=>{ if(recognition) recognition.stop(); });
btnClear.addEventListener('click',()=>{ fullTranscript=''; transcriptEl.innerText=''; editorEl.value=''; detectedEl.innerHTML=''; suggestionsEl.innerHTML=''; tagsEl.innerHTML=''; });

// ======= DetecÃ§Ã£o simples de objeÃ§Ãµes =======
function detectObjections(text){
  const found = [];
  objectionsMap.forEach(o=>{
    if(o.pattern.test(text)) found.push(o);
  });

  detectedEl.innerHTML = '';
  suggestionsEl.innerHTML = '';
  tagsEl.innerHTML = '';

  if(found.length===0){ detectedEl.innerHTML = '<div class="small">Nenhuma objeÃ§Ã£o detectada ainda.</div>'; return; }

  found.forEach(o=>{
    const div = document.createElement('div'); div.className='chip';
    div.innerHTML = '<strong>'+o.label+'</strong><div class="small" style="margin-top:6px">' + o.pattern + '</div>';
    detectedEl.appendChild(div);

    // sugestÃµes rÃ¡pidas
    o.answers.forEach(a=>{
      const b = document.createElement('button'); b.className='chip'; b.textContent = a;
      b.addEventListener('click',()=>{ copyToClipboard(a); highlightSuggestion(b); });
      suggestionsEl.appendChild(b);
    });

    const tag = document.createElement('span'); tag.className='tag'; tag.textContent = o.label; tagsEl.appendChild(tag);
  });
}

function highlightSuggestion(el){
  const siblings = suggestionsEl.querySelectorAll('.chip'); siblings.forEach(s=>s.style.borderStyle='dashed');
  el.style.borderStyle='solid';
}

function copyToClipboard(text){ navigator.clipboard.writeText(text).then(()=>{ alert('Resposta copiada para a Ã¡rea de transferÃªncia'); }); }

// ======= IntegraÃ§Ã£o com Assistente (exemplo) =======
// Ao clicar em "Pedir sugestÃ£o da Assistente", o frontend envia a transcriÃ§Ã£o para o seu backend
// Endpoint exemplo: POST /api/assistant { transcript: "..." }
// O backend entÃ£o deve chamar a OpenAI (ou outro LLM) com a sua chave e devolver uma sugestÃ£o.

btnAsk.addEventListener('click', async ()=>{
  const transcript = transcriptEl.innerText.trim() + '\n' + editorEl.value.trim();
  if(!transcript) return alert('TranscriÃ§Ã£o vazia');
  setStatus('enviando para servidor...');
  try{
    const res = await fetch('/api/assistant', {
      method:'POST',headers:{'Content-Type':'application/json'},
      body: JSON.stringify({transcript})
    });
    if(!res.ok) throw new Error('erro '+res.status);
    const json = await res.json();
    // espera { suggestion: 'texto...' }
    if(json.suggestion){
      const el = document.createElement('div'); el.className='chip'; el.textContent = json.suggestion; el.addEventListener('click',()=>copyToClipboard(json.suggestion));
      suggestionsEl.prepend(el);
      setStatus('sugestÃ£o recebida');
    } else {
      setStatus('resposta sem sugestÃ£o');
    }
  }catch(err){
    console.error(err); setStatus('erro ao chamar servidor');
  }
});

</script>
</body>
</html>
